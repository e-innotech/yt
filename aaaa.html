<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

</head>
<body>
<div class="banxin">
    <textarea id="fileInput"></textarea>
    <div class="btnBox"><input id="num" type="" class="vertical_center" name=""><button class="vertical_center">增加版本号</button></div>
    <textarea id="fileOutput"></textarea>
</div>
</body>


<script  src="http://libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>

<script type="text/javascript">
    var gulp = require('gulp'),
            minifyCss = require('gulp-minify-css'),
            jshint = require('gulp-jshint'),
            uglify = require('gulp-uglify'),
            clean = require('gulp-clean'),
            rev = require('gulp-rev'),
            concat = require('gulp-concat'),
            revReplace = require('gulp-rev-replace'),
            useref = require('gulp-useref'),
            revReplace = require('gulp-rev-replace'),
            revCollector = require('gulp-rev-collector');

    //清空文件夹，避免资源冗余
    gulp.task('clean',function(){
        return gulp.src('dist',{read:false}).pipe(clean());
    });

    //css文件压缩，更改版本号，并通过rev.manifest将对应的版本号用json表示出来
    gulp.task('css',function(){
        return gulp.src('app/styles/*.css')
            //.pipe( concat('wap.min.css') )
                .pipe(minifyCss())
                .pipe(rev())
                .pipe(gulp.dest('dist/app/styles/'))
                .pipe(rev.manifest())
                .pipe(gulp.dest('dist/rev/css'))
    });

    //js文件压缩，更改版本号，并通过rev.manifest将对应的版本号用json表示出
    gulp.task('js',function(){
        return gulp.src('app/scripts/*.js')
            //.pipe( concat('wap.min.js') )
                .pipe(jshint())
                .pipe(uglify())
                .pipe(rev())
                .pipe(gulp.dest('dist/app/scripts/'))
                .pipe(rev.manifest())
                .pipe(gulp.dest('dist/rev/js'))
    });

    //通过hash来精确定位到html模板中需要更改的部分,然后将修改成功的文件生成到指定目录
    gulp.task('rev',function(){
        return gulp.src(['dist/rev/**/*.json','app/pages/*.html'])
                .pipe( revCollector() )
                .pipe(gulp.dest('dist/app/pages/'));
    });

    //合并html页面内引用的静态资源文件
    gulp.task('html', function () {
        return gulp.src('dist/app/pages/*.html')
                .pipe(useref())
                .pipe(rev())
                .pipe(revReplace())
                .pipe(gulp.dest('dist/html/'));
    })
</script>
</html>